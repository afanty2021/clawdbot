# æ ¸å¿ƒä»£ç æ¨¡å— (src/)

[æ ¹ç›®å½•](../CLAUDE.md) > **src**

## æ¨¡å—èŒè´£

OpenClaw çš„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼ŒåŒ…å« AI ä»£ç†è¿è¡Œæ—¶ã€ç½‘å…³æœåŠ¡å™¨ã€é€šä¿¡æ¸ é“ã€é…ç½®ç³»ç»Ÿã€æµè§ˆå™¨è‡ªåŠ¨åŒ–ã€CLI å·¥å…·ã€ä¼šè¯ç®¡ç†å’Œå®šæ—¶ä»»åŠ¡ã€‚

## ç›®å½•ç»“æ„

```
src/
â”œâ”€â”€ agents/           # AI ä»£ç†è¿è¡Œæ—¶
â”œâ”€â”€ gateway/          # ç½‘å…³æœåŠ¡å™¨
â”œâ”€â”€ channels/         # é€šä¿¡æ¸ é“ç³»ç»Ÿ
â”œâ”€â”€ config/           # é…ç½®ç®¡ç†
â”œâ”€â”€ browser/          # æµè§ˆå™¨è‡ªåŠ¨åŒ–
â”œâ”€â”€ cli/              # å‘½ä»¤è¡Œå·¥å…·
â”œâ”€â”€ sessions/         # ä¼šè¯ç®¡ç†
â”œâ”€â”€ cron/             # å®šæ—¶ä»»åŠ¡
â”œâ”€â”€ commands/         # CLI å‘½ä»¤
â”œâ”€â”€ discord/          # Discord é€‚é…å™¨ï¼ˆå·²è¿ç§»åˆ° extensionsï¼‰
â”œâ”€â”€ slack/            # Slack é€‚é…å™¨ï¼ˆå·²è¿ç§»åˆ° extensionsï¼‰
â”œâ”€â”€ signal/           # Signal é€‚é…å™¨ï¼ˆå·²è¿ç§»åˆ° extensionsï¼‰
â”œâ”€â”€ telegram/         # Telegram é€‚é…å™¨ï¼ˆå·²è¿ç§»åˆ° extensionsï¼‰
â”œâ”€â”€ imessage/         # iMessage é€‚é…å™¨ï¼ˆå·²è¿ç§»åˆ° extensionsï¼‰
â”œâ”€â”€ web/              # WhatsApp Web é€‚é…å™¨ï¼ˆå·²è¿ç§»åˆ° extensionsï¼‰
â”œâ”€â”€ hooks/            # Hooks ç³»ç»Ÿ
â”œâ”€â”€ routing/          # æ¶ˆæ¯è·¯ç”±
â”œâ”€â”€ media/            # åª’ä½“å¤„ç†
â””â”€â”€ infra/            # åŸºç¡€è®¾æ–½
```

## å…¥å£ä¸å¯åŠ¨

### ä¸»å…¥å£
- **`src/index.ts`** - ä¸»å…¥å£ï¼Œå¯¼å‡ºæ ¸å¿ƒ API å’Œå¯åŠ¨ CLI ç¨‹åº
- **`src/cli/program.ts`** - CLI ç¨‹åºæ„å»ºå™¨
- **`src/gateway/server.ts`** - ç½‘å…³æœåŠ¡å™¨å…¥å£

### å¯åŠ¨æµç¨‹
1. åŠ è½½ç¯å¢ƒå˜é‡å’Œé…ç½®
2. åˆå§‹åŒ–æ—¥å¿—ç³»ç»Ÿ
3. æ„å»ºå‘½ä»¤è¡Œç¨‹åº
4. æ ¹æ®å‘½ä»¤å¯åŠ¨ç›¸åº”æœåŠ¡ï¼ˆç½‘å…³ã€ä»£ç†ã€CLI ç­‰ï¼‰

## å¯¹å¤–æ¥å£

### AI ä»£ç†æ¥å£
- **`AgentRunner`** - ä»£ç†è¿è¡Œå™¨
- **`ToolRegistry`** - å·¥å…·æ³¨å†Œè¡¨
- **`SessionManager`** - ä¼šè¯ç®¡ç†å™¨

### ç½‘å…³æ¥å£
- **`GatewayServer`** - ç½‘å…³æœåŠ¡å™¨
- **`GatewayProtocol`** - ç½‘å…³åè®®
- **`ClientRegistry`** - å®¢æˆ·ç«¯æ³¨å†Œè¡¨

### æ¸ é“æ¥å£
- **`ChannelPlugin`** - æ¸ é“æ’ä»¶æ¥å£
- **`ChannelMonitor`** - æ¸ é“ç›‘æ§å™¨
- **`OutboundTarget`** - å‡ºç«™ç›®æ ‡

## å…³é”®ä¾èµ–ä¸é…ç½®

### æ ¸å¿ƒä¾èµ–
```json
{
  "@mariozechner/pi-agent-core": "0.52.8",
  "@mariozechner/pi-ai": "0.52.8",
  "@mariozechner/pi-coding-agent": "0.52.8",
  "@whiskeysockets/baileys": "7.0.0-rc.9",
  "grammy": "^1.39.3",
  "@slack/bolt": "^4.6.0",
  "playwright-core": "1.58.2",
  "hono": "4.11.8",
  "express": "^5.2.1"
}
```

### é…ç½®æ–‡ä»¶
- **`src/config/config.ts`** - ä¸»é…ç½®åŠ è½½å™¨
- **`src/config/io.ts`** - é…ç½® I/O æ“ä½œ
- **`src/config/schema.ts`** - é…ç½® Schema å®šä¹‰
- **`src/config/sessions.ts`** - ä¼šè¯é…ç½®

## å­æ¨¡å—è¯¦è§£

### 1. AI ä»£ç†è¿è¡Œæ—¶ (`agents/`)

**èŒè´£**ï¼šPi Agent é›†æˆã€å·¥å…·ç³»ç»Ÿã€æ²™ç®±éš”ç¦»ã€æŠ€èƒ½ç®¡ç†

**å…³é”®æ–‡ä»¶**ï¼š
- `pi-embedded.ts` - Pi åµŒå…¥å¼ä»£ç†
- `pi-tools.ts` - å·¥å…·ç³»ç»Ÿ
- `sandbox.ts` - Docker æ²™ç®±
- `skills/` - æŠ€èƒ½ç®¡ç†

**æ¥å£**ï¼š
- `AgentRunner` - ä»£ç†è¿è¡Œå™¨
- `ToolRegistry` - å·¥å…·æ³¨å†Œè¡¨
- `SandboxContext` - æ²™ç®±ä¸Šä¸‹æ–‡

### 2. ç½‘å…³æœåŠ¡å™¨ (`gateway/`)

**èŒè´£**ï¼šWebSocket æœåŠ¡å™¨ã€åè®®å®ç°ã€å®¢æˆ·ç«¯ç®¡ç†

**å…³é”®æ–‡ä»¶**ï¼š
- `server.ts` - ç½‘å…³æœåŠ¡å™¨
- `protocol/` - åè®®å®šä¹‰
- `client.ts` - å®¢æˆ·ç«¯ç®¡ç†

**æ¥å£**ï¼š
- `GatewayServer` - ç½‘å…³æœåŠ¡å™¨
- `GatewayProtocol` - ç½‘å…³åè®®

### 3. é€šä¿¡æ¸ é“ (`channels/`)

**èŒè´£**ï¼šæ¸ é“æ’ä»¶ç³»ç»Ÿã€é€‚é…å™¨ç®¡ç†ã€æ¶ˆæ¯è·¯ç”±

**å…³é”®æ–‡ä»¶**ï¼š
- `plugins/catalog.ts` - æ¸ é“ç›®å½•
- `plugins/load.ts` - æ’ä»¶åŠ è½½å™¨
- `plugins/types.ts` - æ’ä»¶ç±»å‹

**æ¥å£**ï¼š
- `ChannelPlugin` - æ¸ é“æ’ä»¶
- `ChannelDock` - æ¸ é“åœé ç«™

### 4. é…ç½®ç³»ç»Ÿ (`config/`)

**èŒè´£**ï¼šé…ç½®åŠ è½½ã€éªŒè¯ã€è¿ç§»

**å…³é”®æ–‡ä»¶**ï¼š
- `config.ts` - ä¸»é…ç½®
- `schema.ts` - Schema å®šä¹‰
- `legacy-migrate.ts` - é…ç½®è¿ç§»

**æ¥å£**ï¼š
- `ConfigLoader` - é…ç½®åŠ è½½å™¨
- `ConfigValidator` - é…ç½®éªŒè¯å™¨

### 5. æµè§ˆå™¨è‡ªåŠ¨åŒ– (`browser/`)

**èŒè´£**ï¼šPlaywright é›†æˆã€CDP æ¡¥æ¥ã€å·¥å…·è·¯ç”±

**å…³é”®æ–‡ä»¶**ï¼š
- `server.ts` - æµè§ˆå™¨æœåŠ¡å™¨
- `client.ts` - æµè§ˆå™¨å®¢æˆ·ç«¯
- `pw-session.ts` - Playwright ä¼šè¯
- `routes/` - å·¥å…·è·¯ç”±

**æ¥å£**ï¼š
- `BrowserServer` - æµè§ˆå™¨æœåŠ¡å™¨
- `BrowserClient` - æµè§ˆå™¨å®¢æˆ·ç«¯

### 6. CLI æ¡†æ¶ (`cli/`)

**èŒè´£**ï¼šå‘½ä»¤è¡Œå·¥å…·ã€ä¾èµ–æ³¨å…¥ã€è¿›åº¦æ˜¾ç¤º

**å…³é”®æ–‡ä»¶**ï¼š
- `program.ts` - ç¨‹åºæ„å»ºå™¨
- `deps.ts` - ä¾èµ–æ³¨å…¥

**æ¥å£**ï¼š
- `CliDeps` - CLI ä¾èµ–
- `CommandHandler` - å‘½ä»¤å¤„ç†å™¨

### 7. ä¼šè¯ç®¡ç† (`sessions/`)

**èŒè´£**ï¼šä¼šè¯ç­–ç•¥ã€å¯†é’¥ç®¡ç†ã€è½¬å½•

**å…³é”®æ–‡ä»¶**ï¼š
- `send-policy.ts` - å‘é€ç­–ç•¥
- `session-key-utils.ts` - ä¼šè¯å¯†é’¥å·¥å…·
- `transcript-events.ts` - è½¬å½•äº‹ä»¶

**æ¥å£**ï¼š
- `SendPolicy` - å‘é€ç­–ç•¥
- `SessionLabel` - ä¼šè¯æ ‡ç­¾

### 8. å®šæ—¶ä»»åŠ¡ (`cron/`)

**èŒè´£**ï¼šå®šæ—¶è°ƒåº¦ã€éš”ç¦»ä»£ç†ã€ä»»åŠ¡ä¼ é€’

**å…³é”®æ–‡ä»¶**ï¼š
- `schedule.ts` - è°ƒåº¦å™¨
- `service/` - æœåŠ¡å±‚
- `isolated-agent/` - éš”ç¦»ä»£ç†

**æ¥å£**ï¼š
- `CronScheduler` - å®šæ—¶è°ƒåº¦å™¨

## æµ‹è¯•ä¸è´¨é‡

### æµ‹è¯•æ¡†æ¶
- **Vitest** - å•å…ƒæµ‹è¯•
- **Playwright** - æµè§ˆå™¨æµ‹è¯•
- **Docker** - E2E æµ‹è¯•

### è¦†ç›–ç‡ç›®æ ‡
- **è¡Œè¦†ç›–ç‡**: 70%
- **å‡½æ•°è¦†ç›–ç‡**: 70%
- **åˆ†æ”¯è¦†ç›–ç‡**: 70%
- **è¯­å¥è¦†ç›–ç‡**: 70%

### è´¨é‡å·¥å…·
- **oxlint** - Lint å·¥å…·
- **oxfmt** - æ ¼å¼åŒ–å·¥å…·

## å¸¸è§é—®é¢˜ (FAQ)

### Q: å¦‚ä½•æ·»åŠ æ–°çš„é€šä¿¡æ¸ é“ï¼Ÿ
A: åœ¨ `extensions/` ç›®å½•åˆ›å»ºæ–°çš„æ‰©å±•ï¼Œéµå¾ª `ChannelPlugin` æ¥å£ã€‚

### Q: å¦‚ä½•æ‰©å±• AI å·¥å…·ï¼Ÿ
A: åœ¨ `src/agents/pi-tools.ts` ä¸­æ³¨å†Œæ–°å·¥å…·ï¼Œæˆ–åœ¨ `extensions/` ä¸­åˆ›å»ºå·¥å…·æ‰©å±•ã€‚

### Q: å¦‚ä½•ä¿®æ”¹é…ç½®ï¼Ÿ
A: é€šè¿‡ `openclaw config` å‘½ä»¤æˆ–ç›´æ¥ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼ˆJSON/YAMLï¼‰ã€‚

### Q: å¦‚ä½•è°ƒè¯•ç½‘å…³ï¼Ÿ
A: ä½¿ç”¨ `openclaw gateway --verbose` æˆ–æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ã€‚

## ç›¸å…³æ–‡ä»¶æ¸…å•

### æ ¸å¿ƒæ–‡ä»¶
- `src/index.ts` - ä¸»å…¥å£
- `src/gateway/server.ts` - ç½‘å…³æœåŠ¡å™¨
- `src/cli/program.ts` - CLI ç¨‹åº
- `src/config/config.ts` - é…ç½®åŠ è½½å™¨

### æµ‹è¯•æ–‡ä»¶
- `src/**/*.test.ts` - å•å…ƒæµ‹è¯•
- `src/**/*.live.test.ts` - Live æµ‹è¯•

### æ–‡æ¡£æ–‡ä»¶
- `src/*/claude_cn.md` - å„æ¨¡å—ä¸­æ–‡æ–‡æ¡£

## å˜æ›´è®°å½•

### 2026-02-08 - åˆå§‹åŒ–æ ¸å¿ƒæ¨¡å—æ–‡æ¡£
- âœ… åˆ›å»º `src/CLAUDE.md` æ–‡æ¡£
- ğŸ“‹ è®°å½•æ ¸å¿ƒæ¥å£å’Œå…³é”®æ–‡ä»¶
- ğŸ”— å»ºç«‹å­æ¨¡å—å¯¼èˆª


<claude-mem-context>
# Recent Activity

<!-- This section is auto-generated by claude-mem. Edit content outside the tags. -->

### Feb 10, 2026

| ID | Time | T | Title | Read |
|----|------|---|-------|------|
| #2188 | 10:20 AM | ğŸŸ£ | Created src/browser/CLAUDE.md with comprehensive Playwright/CDP documentation | ~321 |
</claude-mem-context>