# æ²™ç®±æ¨¡å— (src/agents/sandbox/)

[æ ¹ç›®å½•](../../CLAUDE.md) > [src](../CLAUDE.md) > [agents](./CLAUDE.md) > **sandbox**

## æ¨¡å—èŒè´£

æä¾›å®‰å…¨çš„æ²™ç®±æ‰§è¡Œç¯å¢ƒï¼Œç”¨äºéš”ç¦» AI ä»£ç†çš„å·¥å…·æ‰§è¡Œã€‚è¯¥æ¨¡å—ä½¿ç”¨ Docker å®¹å™¨æŠ€æœ¯å®ç°è¿›ç¨‹éš”ç¦»ã€èµ„æºé™åˆ¶å’Œæ–‡ä»¶ç³»ç»Ÿéš”ç¦»ï¼Œç¡®ä¿å·¥å…·æ‰§è¡Œä¸ä¼šå½±å“ä¸»æœºç³»ç»Ÿã€‚

## ç›®å½•ç»“æ„

```
src/agents/sandbox/
â”œâ”€â”€ sandbox.ts           # æ²™ç®±ä¸»ç±»
â”œâ”€â”€ sandbox-paths.ts     # è·¯å¾„ç®¡ç†
â”œâ”€â”€ sandbox-create-args.ts  # åˆ›å»ºå‚æ•°
â”œâ”€â”€ sandbox-skills.ts    # æŠ€èƒ½æ²™ç®±
â”œâ”€â”€ sandbox-agent-config.ts  # ä»£ç†é…ç½®
â”œâ”€â”€ sandbox-merge.ts     # é…ç½®åˆå¹¶
â”œâ”€â”€ sandbox-explain.ts   # é…ç½®è¯´æ˜
â””â”€â”€ resolveSandboxContext.ts  # ä¸Šä¸‹æ–‡è§£æ
```

## å…¥å£ä¸å¯åŠ¨

### ä¸»å…¥å£
- **`src/agents/sandbox/sandbox.ts`** - æ²™ç®±ä¸»ç±»

### åˆ›å»ºæ²™ç®±
```typescript
import { Sandbox } from "./agents/sandbox/sandbox.ts";

const sandbox = await Sandbox.create({
  image: "openclaw-sandbox:latest",
  memory: "2GB",
  cpus: 2,
  timeout: 300000, // 5 minutes
});
```

## å¯¹å¤–æ¥å£

### Sandbox æ¥å£
```typescript
interface Sandbox {
  id: string;
  status: SandboxStatus;
  exec(command: string, args: string[]): Promise<SandboxResult>;
  upload(path: string, content: Buffer): Promise<void>;
  download(path: string): Promise<Buffer>;
  destroy(): Promise<void>;
}
```

### SandboxStatus æšä¸¾
```typescript
enum SandboxStatus {
  CREATING = "creating",
  RUNNING = "running",
  STOPPING = "stopping",
  STOPPED = "stopped",
  ERROR = "error",
}
```

### SandboxResult æ¥å£
```typescript
interface SandboxResult {
  exitCode: number;
  stdout: string;
  stderr: string;
  duration: number;
}
```

## å­æ¨¡å—è¯¦è§£

### 1. æ²™ç®±ä¸»ç±» (`sandbox.ts`)

**èŒè´£**ï¼šç®¡ç†æ²™ç®±ç”Ÿå‘½å‘¨æœŸ

**åŠŸèƒ½**ï¼š
- åˆ›å»º/é”€æ¯æ²™ç®±
- æ‰§è¡Œå‘½ä»¤
- æ–‡ä»¶ä¼ è¾“
- çŠ¶æ€ç›‘æ§

### 2. è·¯å¾„ç®¡ç† (`sandbox-paths.ts`)

**èŒè´£**ï¼šç®¡ç†æ²™ç®±å†…çš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„

**è·¯å¾„æ˜ å°„**ï¼š
```typescript
interface PathMapping {
  hostPath: string;
  containerPath: string;
  readOnly: boolean;
}
```

### 3. ä»£ç†é…ç½® (`sandbox-agent-config.ts`)

**èŒè´£**ï¼šç®¡ç†ä»£ç†çº§åˆ«çš„æ²™ç®±é…ç½®

**é…ç½®é¡¹**ï¼š
- å·¥ä½œç›®å½•
- ç¯å¢ƒå˜é‡
- ç½‘ç»œç­–ç•¥
- èµ„æºé™åˆ¶

### 4. æŠ€èƒ½æ²™ç®± (`sandbox-skills.ts`)

**èŒè´£**ï¼šä¸ºæŠ€èƒ½æä¾›éš”ç¦»çš„æ‰§è¡Œç¯å¢ƒ

### 5. é…ç½®åˆå¹¶ (`sandbox-merge.ts`)

**èŒè´£**ï¼šåˆå¹¶ä¸åŒæ¥æºçš„æ²™ç®±é…ç½®

**åˆå¹¶ç­–ç•¥**ï¼š
1. é»˜è®¤é…ç½®
2. å…¨å±€é…ç½®
3. ä»£ç†é…ç½®
4. å‘½ä»¤è¡Œè¦†ç›–

## å…³é”®ä¾èµ–ä¸é…ç½®

### Docker é…ç½®
```yaml
# docker-compose.yml
services:
  sandbox:
    image: openclaw-sandbox:latest
    mem_limit: 2g
    cpus: 2
    volumes:
      - ./workspace:/workspace:rw
    network_mode: none
```

### é…ç½®æ–‡ä»¶
```typescript
interface SandboxConfig {
  image: string;
  memory: string;
  cpus: number;
  timeout: number;
  volumes: VolumeConfig[];
  environment: Record<string, string>;
  network: "none" | "host" | "bridge";
}
```

### ç¯å¢ƒå˜é‡
```bash
SANDBOX_IMAGE         # Docker é•œåƒ
SANDBOX_MEMORY_LIMIT  # å†…å­˜é™åˆ¶
SANDBOX_CPU_LIMIT     # CPU é™åˆ¶
SANDBOX_TIMEOUT       # é»˜è®¤è¶…æ—¶
```

## æµ‹è¯•ä¸è´¨é‡

### æµ‹è¯•æ–‡ä»¶
- `src/agents/sandbox/**/*.test.ts`

### æµ‹è¯•å‘½ä»¤
```bash
pnpm test src/agents/sandbox
```

## å¸¸è§é—®é¢˜ (FAQ)

### Q: å¦‚ä½•è‡ªå®šä¹‰æ²™ç®±é•œåƒï¼Ÿ
A: è®¾ç½® `SANDBOX_IMAGE` ç¯å¢ƒå˜é‡æˆ–ä¿®æ”¹é…ç½®æ–‡ä»¶ã€‚

### Q: æ²™ç®±ç½‘ç»œå¦‚ä½•é…ç½®ï¼Ÿ
A: ä½¿ç”¨ `network` é…ç½®é¡¹ï¼Œæ”¯æŒ `none`ã€`host`ã€`bridge` ä¸‰ç§æ¨¡å¼ã€‚

### Q: èµ„æºé™åˆ¶å¦‚ä½•è°ƒæ•´ï¼Ÿ
A: åœ¨é…ç½®æ–‡ä»¶çš„ `memory` å’Œ `cpus` å­—æ®µä¸­è®¾ç½®ã€‚

## ç›¸å…³æ–‡ä»¶æ¸…å•

### æ ¸å¿ƒæ–‡ä»¶
- `src/agents/sandbox/sandbox.ts` - æ²™ç®±ä¸»ç±»
- `src/agents/sandbox/sandbox-paths.ts` - è·¯å¾„ç®¡ç†
- `src/agents/sandbox/sandbox-agent-config.ts` - é…ç½®

### CLI æ–‡ä»¶
- `src/cli/sandbox-cli.ts` - æ²™ç®± CLI

## å˜æ›´è®°å½•

### 2026-02-10 - åˆ›å»ºæ²™ç®±æ¨¡å—æ–‡æ¡£
- âœ… åˆ›å»º `src/agents/sandbox/CLAUDE.md` æ–‡æ¡£
- ğŸ“‹ è®°å½• Docker éš”ç¦»å’Œèµ„æºç®¡ç†
- ğŸ”— å»ºç«‹æ²™ç®±æ¶æ„å¯¼èˆª


<claude-mem-context>
# Recent Activity

<!-- This section is auto-generated by claude-mem. Edit content outside the tags. -->

### Feb 10, 2026

| ID | Time | T | Title | Read |
|----|------|---|-------|------|
| #2208 | 10:26 AM | ğŸŸ£ | Created src/agents/sandbox/CLAUDE.md for Docker container isolation | ~328 |
</claude-mem-context>