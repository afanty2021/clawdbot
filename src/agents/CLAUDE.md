<claude-mem-context>
# Recent Activity

<!-- This section is auto-generated by claude-mem. Edit content outside the tags. -->

### Feb 11, 2026

| ID | Time | T | Title | Read |
|----|------|---|-------|------|
| #2637 | 12:23 AM | âœ… | Committed comprehensive Chinese documentation for 6 OpenClaw modules to git | ~493 |
| #2590 | 12:08 AM | âœ… | Created comprehensive Chinese documentation for 6 OpenClaw modules | ~652 |
| #2587 | 12:07 AM | âœ… | Created comprehensive Chinese documentation for 6 OpenClaw modules | ~576 |
</claude-mem-context>

# AI ä»£ç†è¿è¡Œæ—¶æ¨¡å— (agents/)

[æ ¹ç›®å½•](../../CLAUDE.md) > **src/agents**

## æ¨¡å—èŒè´£

é›†æˆ Pi Agent è¿è¡Œæ—¶ã€å·¥å…·ç³»ç»Ÿã€æ²™ç®±éš”ç¦»ã€æŠ€èƒ½ç®¡ç†å’Œè®¤è¯é…ç½®ã€‚

## ç›®å½•ç»“æ„

```
agents/
â”œâ”€â”€ pi-embedded.ts       # Pi åµŒå…¥å¼ä»£ç†æ ¸å¿ƒ
â”œâ”€â”€ pi-tools.ts          # å·¥å…·æ³¨å†Œå’Œç­–ç•¥
â”œâ”€â”€ sandbox.ts           # Docker æ²™ç®±éš”ç¦»
â”œâ”€â”€ skills/              # å·¥ä½œåŒºæŠ€èƒ½ç®¡ç†
â”œâ”€â”€ auth-profiles/       # ğŸ”‘ API å¯†é’¥è®¤è¯é…ç½®
â””â”€â”€ *.test.ts            # æµ‹è¯•ç”¨ä¾‹
```

## å…³é”®æ–‡ä»¶

### pi-embedded.ts
- **èŒè´£**: Pi Agent é›†æˆå’Œ RPC é€šä¿¡
- **å…³é”®å‡½æ•°**:
  - `createPiAgent()` - åˆ›å»º Pi ä»£ç†å®ä¾‹
  - `runPiAgent()` - è¿è¡Œ Pi ä»£ç†
  - `streamPiAgent()` - æµå¼è¾“å‡ºæ”¯æŒ

### pi-tools.ts
- **èŒè´£**: å·¥å…·æ³¨å†Œã€å·¥å…·ç­–ç•¥å®šä¹‰
- **å…³é”®å‡½æ•°**:
  - `registerTool()` - æ³¨å†Œæ–°å·¥å…·
  - `createToolPolicy()` - åˆ›å»ºå·¥å…·ä½¿ç”¨ç­–ç•¥

### sandbox.ts
- **èŒè´£**: Docker æ²™ç®±éš”ç¦»æ‰§è¡Œ
- **å…³é”®ç±»**:
  - `SandboxContext` - æ²™ç®±ä¸Šä¸‹æ–‡
  - `SandboxRunner` - æ²™ç®±è¿è¡Œå™¨

### auth-profiles/ ğŸ”‘
- **èŒè´£**: API å¯†é’¥å’Œè®¤è¯å‡­æ®ç®¡ç†
- **å…³é”®æ–‡ä»¶**:
  - `auth-profiles.ts` - è®¤è¯é…ç½® CRUD
  - `types.ts` - å‡­è¯ç±»å‹å®šä¹‰
  - `oauth.ts` - OAuth 2.0 å¤„ç†
- **è¯¦è§**: [auth-profiles/CLAUDE.md](./auth-profiles/CLAUDE.md)

## å…³é”®ç±»å‹

### AgentRunner
```typescript
interface AgentRunner {
  start(): Promise<void>;
  stop(): void;
  sendMessage(message: string): Promise<string>;
  streamMessage(message: string): AsyncIterable<string>;
}
```

### ToolRegistry
```typescript
interface ToolRegistry {
  register(tool: Tool): void;
  unregister(name: string): void;
  get(name: string): Tool | undefined;
  list(): Tool[];
}
```

### AuthProfileStore
```typescript
interface AuthProfileStore {
  version: 1;
  profiles: Record<string, AuthProfile>;
  usage: Record<string, AuthUsage>;
}
```

## è®¤è¯é…ç½®

### é…ç½®æ–‡ä»¶ä½ç½®
1. `${PROJECT_ROOT}/auth-profiles.json`
2. `~/.openclaw/agents/main/agent/auth-profiles.json`
3. `*_API_KEY` ç¯å¢ƒå˜é‡ï¼ˆåå¤‡ï¼‰

### æ”¯æŒçš„æä¾›å•†
- **Z.AI (BigModel)**: `zai:default`
- **Anthropic Claude**: `anthropic:default`
- **OpenAI**: `openai:default`
- **å…¶ä»–**: é€šè¿‡æ‰©å±•æ”¯æŒ

## æµ‹è¯•

### å•å…ƒæµ‹è¯•
```bash
pnpm test src/agents/*.test.ts
pnpm test src/agents/auth-profiles/*.test.ts
```

### Live æµ‹è¯•
```bash
pnpm test:live src/agents/**/*.live.test.ts
```

## å¸¸è§é—®é¢˜ (FAQ)

### Q: å¦‚ä½•æ·»åŠ æ–°çš„ AI å·¥å…·ï¼Ÿ
A: åœ¨ `pi-tools.ts` ä¸­ä½¿ç”¨ `registerTool()` æ³¨å†Œï¼Œæˆ–åˆ›å»ºç‹¬ç«‹çš„å·¥å…·æ‰©å±•ã€‚

### Q: å¦‚ä½•é…ç½®è®¤è¯ï¼Ÿ
A: ç¼–è¾‘ `auth-profiles.json` æ–‡ä»¶ï¼Œæ·»åŠ æä¾›å•†é…ç½®ã€‚

### Q: æ²™ç®±å¦‚ä½•éš”ç¦»æ‰§è¡Œï¼Ÿ
A: ä½¿ç”¨ Docker å®¹å™¨è¿è¡Œä»£ç ï¼Œæä¾›æ–‡ä»¶ç³»ç»Ÿå’Œç½‘ç»œéš”ç¦»ã€‚

## ç›¸å…³æ¨¡å—

- **ç½‘å…³æœåŠ¡å™¨** (`src/gateway/`) - WebSocket é€šä¿¡
- **æµè§ˆå™¨æ§åˆ¶** (`src/browser/`) - æµè§ˆå™¨è‡ªåŠ¨åŒ–å·¥å…·
- **é…ç½®ç³»ç»Ÿ** (`src/config/`) - ä¸»é…ç½®ç®¡ç†

## å˜æ›´è®°å½•

### 2026-02-09 - è®¤è¯ç³»ç»Ÿé›†æˆ
- âœ… é›†æˆ `auth-profiles/` è®¤è¯é…ç½®æ¨¡å—
- âœ… æ–‡æ¡£åŒ–è®¤è¯é…ç½®ä¼˜å…ˆçº§å’Œç»“æ„
- ğŸ” è¯Šæ–­ Z.AI æä¾›å•† 401 è®¤è¯é”™è¯¯

### 2026-02-08 - åˆå§‹åŒ–ä»£ç†æ¨¡å—æ–‡æ¡£
- âœ… åˆ›å»º `src/agents/CLAUDE.md` æ–‡æ¡£
- ğŸ“‹ è®°å½•æ ¸å¿ƒæ¥å£å’Œå…³é”®æ–‡ä»¶
- ğŸ”— å»ºç«‹å­æ¨¡å—å¯¼èˆª
