# Hooks ç³»ç»Ÿæ¨¡å— (src/hooks/)

[æ ¹ç›®å½•](../../CLAUDE.md) > [src](../CLAUDE.md) > **hooks**

## æ¨¡å—èŒè´£

æä¾›ç”Ÿå‘½å‘¨æœŸé’©å­ç³»ç»Ÿï¼Œå…è®¸åœ¨ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶æ‰§è¡Œè‡ªå®šä¹‰é€»è¾‘ã€‚Hooks ç³»ç»Ÿæ˜¯ OpenClaw æ‰©å±•æœºåˆ¶çš„æ ¸å¿ƒï¼Œæ”¯æŒäº‹ä»¶ç›‘å¬ã€é¢„å¤„ç†/åå¤„ç†ã€è®¤è¯æµç¨‹å®šåˆ¶ç­‰åœºæ™¯ã€‚

## ç›®å½•ç»“æ„

```
src/hooks/
â”œâ”€â”€ bundled/            # å†…ç½® Hooks
â”‚   â”œâ”€â”€ hooks.ts
â”‚   â”œâ”€â”€ install.ts
â”‚   â”œâ”€â”€ internal-hooks.ts
â”‚   â”œâ”€â”€ hooks-install.e2e.test.ts
â”‚   â””â”€â”€ hooks-status.ts
â”œâ”€â”€ loader.ts           # Hook åŠ è½½å™¨
â”œâ”€â”€ plugin-hooks.ts     # æ’ä»¶ Hooks
â”œâ”€â”€ install.ts          # å®‰è£…é€»è¾‘
â”œâ”€â”€ types.ts            # ç±»å‹å®šä¹‰
â”œâ”€â”€ workspace.ts        # å·¥ä½œåŒº Hooks
â”œâ”€â”€ frontmatter.ts      # å…ƒæ•°æ®è§£æ
â”œâ”€â”€ loader.test.ts      # åŠ è½½æµ‹è¯•
â”œâ”€â”€ config.ts           # Hook é…ç½®
â”œâ”€â”€ gmail-ops.ts       # Gmail æ“ä½œ
â”œâ”€â”€ gmail.ts            # Gmail Hook
â”œâ”€â”€ gmail-watcher.ts   # Gmail ç›‘å¬
â”œâ”€â”€ gmail-setup-utils.ts  # Gmail è®¾ç½®
â”œâ”€â”€ soul-evil.ts        # Soul Evil Hook
â”œâ”€â”€ llm-slug-generator.ts  # LLM Slug ç”Ÿæˆ
â”œâ”€â”€ types.ts            # ç±»å‹å®šä¹‰
â””â”€â”€ bundled-dir.ts      # å†…ç½®ç›®å½•
```

## å…¥å£ä¸å¯åŠ¨

### ä¸»å…¥å£
- **`src/hooks/loader.ts`** - Hook åŠ è½½å™¨
- **`src/hooks/install.ts`** - Hook å®‰è£…å™¨

### åŠ è½½æµç¨‹
```typescript
import { HooksLoader } from "./hooks/loader.ts";

const loader = new HooksLoader();
await loader.loadAll();
```

## å¯¹å¤–æ¥å£

### HooksLoader æ¥å£
```typescript
interface HooksLoader {
  loadAll(): Promise<Hook[]>;
  load(id: string): Promise<Hook | null>;
  register(hook: Hook): void;
  unregister(id: string): void;
}
```

### Hook æ¥å£
```typescript
interface Hook {
  id: string;
  name: string;
  version: string;
  events: HookEvent[];
  execute(event: HookEventContext): Promise<HookResult>;
  validate(): ValidationResult;
}
```

### HookEvent æšä¸¾
```typescript
enum HookEvent {
  BEFORE_MESSAGE = "before_message",
  AFTER_MESSAGE = "after_message",
  BEFORE_TOOL_CALL = "before_tool_call",
  AFTER_TOOL_CALL = "after_tool_call",
  ON_ERROR = "on_error",
  ON_CONNECT = "on_connect",
  ON_DISCONNECT = "on_disconnect",
  SCHEDULED = "scheduled",
}
```

### HookEventContext æ¥å£
```typescript
interface HookEventContext {
  event: HookEvent;
  timestamp: Date;
  data: Record<string, unknown>;
  metadata?: {
    sessionId?: string;
    channelId?: string;
    userId?: string;
  };
}
```

## å­æ¨¡å—è¯¦è§£

### 1. å†…ç½® Hooks (`bundled/`)

**èŒè´£**ï¼šæä¾›å¼€ç®±å³ç”¨çš„ç³»ç»Ÿ Hooks

**å†…ç½® Hooks**ï¼š
- `install` - å®‰è£… Hook
- `internal-hooks` - å†…éƒ¨ Hooks
- `hooks-status` - çŠ¶æ€æŸ¥è¯¢

### 2. Hook åŠ è½½å™¨ (`loader.ts`)

**èŒè´£**ï¼šæ‰«æã€åŠ è½½å’ŒéªŒè¯ Hooks

**åŠ è½½ä¼˜å…ˆçº§**ï¼š
1. å·¥ä½œåŒº Hooks (`~/.local/share/openclaw/hooks/`)
2. å†…ç½® Hooks (`src/hooks/bundled/`)
3. æ’ä»¶ Hooks

### 3. Hook å®‰è£… (`install.ts`)

**èŒè´£**ï¼šHook çš„å®‰è£…ã€å‡çº§å’Œå¸è½½

### 4. Gmail Hooks

**èŒè´£**ï¼šGmail é›†æˆç›¸å…³çš„ Hooks

**å…³é”®æ–‡ä»¶**ï¼š
- `gmail.ts` - Gmail Hook
- `gmail-watcher.ts` - é‚®ä»¶ç›‘å¬
- `gmail-setup-utils.ts` - è®¾ç½®å·¥å…·
- `gmail-ops.ts` - Gmail æ“ä½œ

### 5. å·¥ä½œåŒº Hooks (`workspace.ts`)

**èŒè´£**ï¼šç®¡ç†å·¥ä½œåŒºçº§åˆ«çš„ Hooks

## å…³é”®ä¾èµ–ä¸é…ç½®

### é…ç½®æ–‡ä»¶
```yaml
# hooks.yaml
hooks:
  enabled:
    - gmail
    - install
  disabled: []
  workspace:
    enabled: true
    path: .openclaw/hooks
```

### ç¯å¢ƒå˜é‡
```bash
HOOKS_DIR            # Hooks ç›®å½•
HOOKS_BUNDLED_PATH   # å†…ç½® Hooks è·¯å¾„
```

## æµ‹è¯•ä¸è´¨é‡

### æµ‹è¯•æ–‡ä»¶
- `src/hooks/**/*.test.ts`

### æµ‹è¯•å‘½ä»¤
```bash
pnpm test src/hooks
```

## å¸¸è§é—®é¢˜ (FAQ)

### Q: å¦‚ä½•åˆ›å»ºæ–° Hookï¼Ÿ
A: å®ç° `Hook` æ¥å£ï¼Œåœ¨ `hooks.yaml` ä¸­æ³¨å†Œã€‚

### Q: Hook æ‰§è¡Œé¡ºåºå¦‚ä½•ç¡®å®šï¼Ÿ
A: æ ¹æ® `priority` å±æ€§æ’åºï¼ŒåŒä¼˜å…ˆçº§æŒ‰æ³¨å†Œé¡ºåºã€‚

### Q: Hook é”™è¯¯å¦‚ä½•å¤„ç†ï¼Ÿ
A: æ ¹æ®é”™è¯¯ç­–ç•¥ï¼ˆfail-silentã€fail-throwã€retryï¼‰å¤„ç†ã€‚

## ç›¸å…³æ–‡ä»¶æ¸…å•

### æ ¸å¿ƒæ–‡ä»¶
- `src/hooks/loader.ts` - Hook åŠ è½½å™¨
- `src/hooks/install.ts` - å®‰è£…å™¨
- `src/hooks/types.ts` - ç±»å‹å®šä¹‰

### CLI æ–‡ä»¶
- `src/cli/hooks-cli.ts` - Hooks CLI

## å˜æ›´è®°å½•

### 2026-02-10 - åˆ›å»º Hooks æ¨¡å—æ–‡æ¡£
- âœ… åˆ›å»º `src/hooks/CLAUDE.md` æ–‡æ¡£
- ğŸ“‹ è®°å½• Hook åŠ è½½å’Œæ‰§è¡Œç³»ç»Ÿ
- ğŸ”— å»ºç«‹ Hooks ç±»å‹å¯¼èˆª


<claude-mem-context>
# Recent Activity

<!-- This section is auto-generated by claude-mem. Edit content outside the tags. -->

### Feb 10, 2026

| ID | Time | T | Title | Read |
|----|------|---|-------|------|
| #2212 | 10:30 AM | ğŸŸ£ | Documentation coverage campaign achieved 100% core module coverage | ~546 |
| #2207 | 10:25 AM | ğŸŸ£ | Documentation coverage significantly improved - 10 new CLAUDE.md files created | ~538 |
</claude-mem-context>