# Diagnostics OpenTelemetry æ‰©å±•

[è¿”å›ç›®å½•](../CLAUDE.md) > **extensions/diagnostics-otel**

## æ¨¡å—èŒè´£

OpenTelemetry è¯Šæ–­å¯¼å‡ºå™¨ï¼Œå°†è¯Šæ–­äº‹ä»¶å¯¼å‡ºåˆ° OpenTelemetry æ”¶é›†å™¨ã€‚

## åŠŸèƒ½æ¦‚è¿°

### OpenTelemetry é›†æˆ
- **æ—¥å¿—å¯¼å‡º**ï¼šä½¿ç”¨ OTLP HTTP å¯¼å‡ºå™¨
- **æŒ‡æ ‡å¯¼å‡º**ï¼šä½¿ç”¨ OTLP HTTP å¯¼å‡ºå™¨
- **è¿½è¸ªå¯¼å‡º**ï¼šä½¿ç”¨ OTLP HTTP å¯¼å‡ºå™¨
- **èµ„æºç®¡ç†**ï¼šè‡ªåŠ¨é…ç½®èµ„æºå±æ€§
- **SDK é›†æˆ**ï¼šå®Œæ•´çš„ OpenTelemetry Node.js SDK

### æ”¯æŒçš„ä¿¡å·ç±»å‹
1. **Logsï¼ˆæ—¥å¿—ï¼‰**ï¼š`@opentelemetry/sdk-logs`
2. **Metricsï¼ˆæŒ‡æ ‡ï¼‰**ï¼š`@opentelemetry/sdk-metrics`
3. **Tracesï¼ˆè¿½è¸ªï¼‰**ï¼š`@opentelemetry/sdk-trace-base`

## å…³é”®ä¾èµ–

### OpenTelemetry æ ¸å¿ƒåŒ…
- `@opentelemetry/api` - æ ¸å¿ƒ API
- `@opentelemetry/api-logs` - æ—¥å¿— API
- `@opentelemetry/resources` - èµ„æºç®¡ç†
- `@opentelemetry/sdk-node` - Node.js SDK
- `@opentelemetry/sdk-logs` - æ—¥å¿— SDK
- `@opentelemetry/sdk-metrics` - æŒ‡æ ‡ SDK
- `@opentelemetry/sdk-trace-base` - è¿½è¸ª SDK åŸºç¡€

### å¯¼å‡ºå™¨
- `@opentelemetry/exporter-logs-otlp-http` - OTLP æ—¥å¿—å¯¼å‡ºå™¨
- `@opentelemetry/exporter-metrics-otlp-http` - OTLP æŒ‡æ ‡å¯¼å‡ºå™¨
- `@opentelemetry/exporter-trace-otlp-http` - OTLP è¿½è¸ªå¯¼å‡ºå™¨

### è¯­ä¹‰çº¦å®š
- `@opentelemetry/semantic-conventions` - æ ‡å‡†è¯­ä¹‰çº¦å®š

## å¯¹å¤–æ¥å£

### æœåŠ¡æ³¨å†Œ
```typescript
api.registerService(createDiagnosticsOtelService());
```

### æ’ä»¶é…ç½®
```typescript
{
  id: "diagnostics-otel",
  name: "Diagnostics OpenTelemetry",
  description: "Export diagnostics events to OpenTelemetry",
  configSchema: emptyPluginConfigSchema(),
}
```

## ä½¿ç”¨è¯´æ˜

### è‡ªåŠ¨å¯ç”¨
æ’ä»¶æ³¨å†Œåè‡ªåŠ¨åˆ›å»º OpenTelemetry æœåŠ¡ï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚

### OTLP ç«¯ç‚¹
é»˜è®¤å¯¼å‡ºåˆ°æ ‡å‡† OTLP HTTP ç«¯ç‚¹ï¼š
- **æ—¥å¿—**ï¼š`/v1/logs`
- **æŒ‡æ ‡**ï¼š`/v1/metrics`
- **è¿½è¸ª**ï¼š`/v1/traces`

### å¸¸è§æ”¶é›†å™¨
- **Jaeger**ï¼šæ”¯æŒ OTLP HTTP
- **Zipkin**ï¼šéœ€è¦è½¬æ¢å™¨
- **Prometheus**ï¼šä»…æŒ‡æ ‡
- **OpenTelemetry Collector**ï¼šå®Œæ•´æ”¯æŒ

## é…ç½®é€‰é¡¹

### ç¯å¢ƒå˜é‡
```bash
# OTLP ç«¯ç‚¹
export OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4318

# å¯¼å‡ºåè®®
export OTEL_EXPORTER_OTLP_PROTOCOL=http/protobuf

# èµ„æºå±æ€§
export OTEL_RESOURCE_ATTRIBUTES=service.name=openclaw
```

### æ”¶é›†å™¨é…ç½®
```yaml
# OpenTelemetry Collector é…ç½®ç¤ºä¾‹
receivers:
  otlp:
    protocols:
      http:
        endpoint: 0.0.0.0:4318

exporters:
  logging:
    loglevel: debug

service:
  pipelines:
    logs:
      receivers: [otlp]
      exporters: [logging]
    metrics:
      receivers: [otlp]
      exporters: [logging]
    traces:
      receivers: [otlp]
      exporters: [logging]
```

## æ³¨æ„äº‹é¡¹

1. **æ€§èƒ½å½±å“**ï¼šOpenTelemetry ä¼šå¸¦æ¥å°‘é‡æ€§èƒ½å¼€é”€
2. **ç½‘ç»œè¦æ±‚**ï¼šéœ€è¦ç½‘ç»œè¿æ¥åˆ° OTLP æ”¶é›†å™¨
3. **æ•°æ®æ•æ„Ÿ**ï¼šç¡®ä¿æ”¶é›†å™¨å®‰å…¨ï¼Œé¿å…æ³„éœ²æ•æ„Ÿä¿¡æ¯
4. **ç‰ˆæœ¬å…¼å®¹**ï¼šä½¿ç”¨ 0.212.0 ç‰ˆæœ¬çš„å¯¼å‡ºå™¨

## ç›¸å…³æ–‡ä»¶

### æ ¸å¿ƒæ–‡ä»¶
- `index.ts` - æ’ä»¶å…¥å£
- `src/service.ts` - OpenTelemetry æœåŠ¡å®ç°
- `src/service.test.ts` - æœåŠ¡æµ‹è¯•

### é…ç½®æ–‡ä»¶
- `package.json` - æ’ä»¶æ¸…å•å’Œä¾èµ–

## å˜æ›´è®°å½•

### 2026-02-13 - åˆå§‹åˆ›å»º
- âœ… åˆ›å»º Diagnostics OpenTelemetry æ‰©å±•æ–‡æ¡£
- ğŸ“‹ è®°å½• OpenTelemetry é›†æˆé…ç½®
- ğŸ”— å»ºç«‹ä¸è¯Šæ–­ç³»ç»Ÿçš„å…³è”


<claude-mem-context>
# Recent Activity

<!-- This section is auto-generated by claude-mem. Edit content outside the tags. -->

*No recent activity*
</claude-mem-context>